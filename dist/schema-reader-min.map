{"version":3,"sources":["browserHeader.js","schema-reader.js","browserFooter.js"],"names":["module","Object","defineProperty","exports","value","SchemaReader","connection","batchSize","onSuccess","onFailure","this","type","isFetching","skipErrors","readRelWithUdefNames","populate","prototype","preMetas","completeMetas","nameBatches","threadCount","res","describeGlobal","getArray","i","length","batch","j","push","name","failed","handledFailure","that","cb","err","console","log","fail","fetchCompleteMeta","objs","success","fetchSuccess","metas","registerMeta","e","describeSObjects","obj","shallowReadFields","visitor","validateState","objName","shallowReadMetaFieldsAbr","shallowReadMetaFields","visited","path","fields","f","subPath","slice","deepReadFields","deepReadMetaFieldsAbr","deepReadMetaFields","t","referenceTo","childRelationships","rel","relationshipName","childSObject","shallowReadChildRelationships","shallowReadMetaChildRelationshipsAbr","shallowReadMetaChildRelationships","r","createFilterVisitor","filter","field","object","reader","newObjectNameFilter","caseSensitive","toLowerCase","newFieldNameFilter","fieldName","newObjectAndFieldNameFilter","window"],"mappings":"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","file":"schema-reader-min.js","sourcesContent":["var module = {};\nvar exports = {};","// Requires a salesforce connection object, unless the metadata is passed directly\n// to the reader.\n// Leave onSuccess out if you don't want to populate metadata on construction\n'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n\tvalue: true\n});\nvar SchemaReader = function SchemaReader(connection, batchSize, onSuccess, onFailure) {\n\tthis.type = 'SchemaReader';\n\tthis.connection = connection;\n\tthis.isFetching = true;\n\tthis.batchSize = typeof batchSize == 'undefined' ? 100 : batchSize;\n\tthis.skipErrors = typeof onFailure == 'undefined' ? true : false;\n\tthis.readRelWithUdefNames = false;\n\n\tif (typeof onSuccess === 'function') this.populate(onSuccess, onFailure);\n};\n\nSchemaReader.prototype = {\n\tpopulate: function populate(onSuccess, onFailure) {\n\t\tthis.preMetas = [];\n\t\tthis.completeMetas = {};\n\t\tthis.nameBatches = [];\n\n\t\tvar threadCount = 0;\n\t\tvar res = this.connection.describeGlobal();\n\t\tthis.preMetas = res.getArray(\"sobjects\");\n\n\t\t// Push batches\n\t\tfor (var i = 0; i < this.preMetas.length;) {\n\t\t\tvar batch = [];\n\t\t\tfor (var j = 0; i < this.preMetas.length && j < this.batchSize; i++, j++) batch.push(this.preMetas[i].name);\n\t\t\tthis.nameBatches.push(batch);\n\t\t}\n\n\t\tvar failed = false;\n\t\tvar handledFailure = false;\n\t\tvar that = this;\n\t\tvar cb = function cb(err) {\n\t\t\tif (handledFailure) return;\n\t\t\tif (failed) {\n\t\t\t\tconsole.log(err);\n\t\t\t\tonFailure(err);\n\t\t\t\thandledFailure = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthreadCount--;\n\t\t\tconsole.log(threadCount);\n\t\t\tif (threadCount <= 0) {\n\t\t\t\tthat.isFetching = false;\n\t\t\t\tonSuccess();\n\t\t\t}\n\t\t};\n\t\tvar fail = function fail(err) {\n\t\t\tif (!that.skipErrors) {\n\t\t\t\tfailed = true;\n\t\t\t\tonFailure(err);\n\t\t\t} else console.log(err); // Currently only logging the error\n\t\t\tcb(err);\n\t\t};\n\n\t\t// Get complete metas\n\t\tfor (var i = 0; i < this.nameBatches.length; i++) {\n\t\t\tconsole.log('Batch : ' + this.nameBatches[i]);\n\t\t\tthreadCount++;\n\t\t\tthis.fetchCompleteMeta(this.nameBatches[i], cb, fail);\n\t\t}\n\t},\n\t// Read the array of pre metas and populate completeMetas\n\tfetchCompleteMeta: function fetchCompleteMeta(objs, success, fail) {\n\t\tvar that = this;\n\t\tvar fetchSuccess = function fetchSuccess(metas) {\n\t\t\ttry {\n\t\t\t\tfor (var i = 0; i < metas.length; i++) that.registerMeta(metas[i]);\n\t\t\t} catch (e) {\n\t\t\t\tfail(e);\n\t\t\t} finally {\n\t\t\t\tsuccess();\n\t\t\t} // call the callback\n\t\t};\n\t\tthis.connection.describeSObjects(objs, fetchSuccess, fail);\n\t},\n\tregisterMeta: function registerMeta(obj) {\n\t\tthis.completeMetas[obj.name] = obj;\n\t},\n\t// see deepread fields for the visitor definition\n\tshallowReadFields: function shallowReadFields(visitor) {\n\t\tthis.validateState();\n\t\tfor (var objName in this.completeMetas) if (this.shallowReadMetaFieldsAbr(this.completeMetas[objName], visitor) === 'term') return 'term';\n\t},\n\t// see deepread fields for the visitor definition\n\tshallowReadMetaFields: function shallowReadMetaFields(obj, visited, path, visitor) {\n\t\tthis.validateState();\n\t\tif (typeof obj.fields === 'undefined') {\n\t\t\tconsole.log('The object has no fields defined');\n\t\t\treturn;\n\t\t}\n\t\tfor (var i = 0; i < obj.fields.length; i++) {\n\t\t\tvar f = obj.fields[i];\n\t\t\tif (typeof f === 'undefined') continue;\n\t\t\tvar subPath = path.slice(0);\n\t\t\tsubPath.push(f);\n\t\t\tif (visitor(f, obj, subPath, this) === 'term') return 'term';\n\t\t}\n\t},\n\t// An abbreviation (Abr) method to shallow read beginning with the passed object\n\t// see deepread fields for the visitor definition\n\tshallowReadMetaFieldsAbr: function shallowReadMetaFieldsAbr(obj, visitor) {\n\t\tvar visited = {};\n\t\tvisited[obj.name] = true;\n\t\treturn this.shallowReadMetaFields(obj, visited, [obj], visitor);\n\t},\n\t// visitor definition: function(field, object, path, reader) {\n\t// \t\t// return 'term' // if you want to terminate the schema read\n\t// }\n\t// field : {} - the field description under read,\n\t// object : {} - the sobject description under read\n\t// path : [] - a list of descriptions starting with the sobject description, trailed by\n\t//\t\t\t\trelationship descriptions and ending with a field description\n\t// reader : the reader which is currently used to read the schema\n\tdeepReadFields: function deepReadFields(visitor) {\n\t\tthis.validateState();\n\t\tfor (var objName in this.completeMetas) if (this.deepReadMetaFieldsAbr(this.completeMetas[objName], visitor) === 'term') return 'term';\n\t},\n\t// see deepread fields for the visitor definition\n\tdeepReadMetaFields: function deepReadMetaFields(obj, visited, path, visitor) {\n\t\tthis.validateState();\n\t\tif (visited[obj.name] == true) return;\n\t\tif (typeof obj.fields === 'undefined') return;\n\t\tvisited[obj.name] = true;\n\n\t\tif (path.length == 0) path.push(obj);\n\n\t\tfor (var i = 0; i < obj.fields.length; i++) {\n\t\t\tvar f = obj.fields[i];\n\t\t\tif (typeof f === 'undefined') continue;\n\t\t\tvar subPath = path.slice(0);\n\t\t\tsubPath.push(f);\n\t\t\tif (visitor(f, obj, subPath, this) === 'term') return 'term';\n\t\t\tif (t.type === 'reference') if (this.deepReadMetaFields(this.completeMetas[f.referenceTo], visited, subPath, visitor) === 'term') return 'term';\n\t\t}\n\t\tif (typeof obj.childRelationships == 'undefined') return;\n\t\tfor (var i = 0; i < obj.childRelationships.length; i++) {\n\t\t\tvar rel = obj.childRelationships[i];\n\t\t\tif (!this.readRelWithUdefNames && typeof rel.relationshipName === 'undefined') continue;\n\t\t\tvar subPath = path.slice(0);\n\t\t\tsubPath.push(rel);\n\t\t\tif (this.deepReadMetaFields(this.completeMetas[rel.childSObject], visited, subPath, visitor) === 'term') return 'term';\n\t\t}\n\t},\n\t// An abbreviation (Abr) method to deep read starting with the passed object\n\t// see deepread fields for the visitor definition\n\tdeepReadMetaFieldsAbr: function deepReadMetaFieldsAbr(obj, visitor) {\n\t\treturn this.deepReadMetaFields(obj, [], [], visitor);\n\t},\n\t// visitor definition: function(field, object, path, reader) {\n\t// \t\t// return 'term' // if you want to terminate the schema read\n\t// }\n\t// rel : {} - the relationship description under read,\n\t// object : {} - the sobject description under read\n\t// path : [] - a list of descriptions starting with the sobject description, trailed by\n\t//\t\t\t\trelationship descriptions\n\t// reader : the reader which is currently used to read the schema\n\tshallowReadChildRelationships: function shallowReadChildRelationships(visitor) {\n\t\tthis.validateState();\n\t\tfor (var objName in this.completeMetas) if (this.shallowReadMetaChildRelationshipsAbr(this.completeMetas[objName], visitor) === 'term') return 'term';\n\t},\n\t// see shallowReadChildRelationships fields for the visitor definition\n\tshallowReadMetaChildRelationships: function shallowReadMetaChildRelationships(obj, visited, path, visitor) {\n\t\tthis.validateState();\n\t\tif (typeof obj.childRelationships === 'undefined') {\n\t\t\tconsole.log('The object has no child relationships defined');\n\t\t\treturn;\n\t\t}\n\t\tfor (var i = 0; i < obj.childRelationships.length; i++) {\n\t\t\tvar r = obj.childRelationships[i];\n\t\t\tif (typeof r === 'undefined') continue;\n\t\t\tvar subPath = path.slice(0);\n\t\t\tsubPath.push(r);\n\t\t\tif (visitor(r, obj, subPath, this) === 'term') return 'term';\n\t\t}\n\t},\n\t// An abbreviation (Abr) method to shallow read starting with the passed object\n\t// see shallowReadChildRelationships fields for the visitor definition\n\tshallowReadMetaChildRelationshipsAbr: function shallowReadMetaChildRelationshipsAbr(obj, visitor) {\n\t\tvar visited = {};\n\t\tvisited[obj.name] = true;\n\t\treturn this.shallowReadMetaChildRelationships(obj, visited, [obj], visitor);\n\t},\n\tvalidateState: function validateState() {\n\t\tif (this.isFetching) throw this.type + \" hasn't finished fetching metadata from the server\";\n\t},\n\n\t// filters\n\tcreateFilterVisitor: function createFilterVisitor(filter, visitor) {\n\t\treturn function (field, object, path, reader) {\n\t\t\tif (filter(field, object, path, reader)) visitor(field, object, path, reader);\n\t\t};\n\t},\n\tnewObjectNameFilter: function newObjectNameFilter(objName, visitor, caseSensitive) {\n\t\treturn function (field, object, path, reader) {\n\t\t\tif (!caseSensitive && objName.toLowerCase() === object.name.toLowerCase() || caseSensitive && objName === object.name) visitor(field, object, path, reader);\n\t\t};\n\t},\n\tnewFieldNameFilter: function newFieldNameFilter(fieldName, visitor, caseSensitive) {\n\t\treturn function (field, object, path, reader) {\n\t\t\tif (!caseSensitive && fieldName.toLowerCase() === field.name.toLowerCase() || caseSensitive && fieldName === field.name) visitor(field, object, path, reader);\n\t\t};\n\t},\n\tnewObjectAndFieldNameFilter: function newObjectAndFieldNameFilter(fieldName, objName, visitor, caseSensitive) {\n\t\treturn function (field, object, path, reader) {\n\t\t\tif ((!caseSensitive && fieldName.toLowerCase() === field.name.toLowerCase() || caseSensitive && fieldName === field.name) && (!caseSensitive && objName.toLowerCase() === object.name.toLowerCase() || caseSensitive && objName === object.name)) visitor(field, object, path, reader);\n\t\t};\n\t}\n};\n\nexports['default'] = SchemaReader;\nmodule.exports = exports['default'];","window.SchemaReader = SchemaReader;"]}